version: 2.1

jobs:
  ui-tests:
    docker:
      - image: cimg/node:20.19.3-browsers
    steps:
      - checkout
      - run:
          name: Install UI Dependencies
          command: |
            cd ui_tests
            npm install
      - run:
          name: Install ChromeDriver
          command: |
            npm install -g chromedriver --unsafe-perm --allow-root
      - run:
          name: Run UI Tests
          command: |
            cd ui_tests
            npm run test -- --env chrome

  api-tests:
    docker:
      - image: cimg/node:18.17
    steps:
      - checkout
      - run:
          name: Install API Dependencies
          command: |
            cd api_tests
            npm install
      - run:
          name: Start API Server in Background
          command: |
            cd api_tests
            nohup npm run dev > server.log 2>&1 &
      - run:
          name: Wait for Server to Start
          command: |
            sleep 5  # Adjust if your server needs more time
      - run:
          name: Run API Tests
          command: |
            cd api_tests
            npm run test

workflows:
  version: 2
  test-workflow:
    jobs:
      - ui-tests
      - api-tests:
          requires:
            - ui-tests
